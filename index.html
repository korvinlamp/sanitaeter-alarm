<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Sanit√§ter Alarm</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f9f0;
            text-align: center;
            padding: 30px;
            font-size: 20px;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 700px;
            margin: auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }
        h2, h3 {
            color: #dc3545;
        }
        label, input, select {
            font-size: 20px;
            margin: 10px 0;
            display: block;
            width: 90%;
            margin-left: auto;
            margin-right: auto;
        }
        input, select {
            padding: 10px;
        }
        button {
            font-weight: bold;
            font-size: 20px;
            margin: 10px auto;
            padding: 15px;
            width: 80%;
            max-width: 350px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: block;
        }
        button.primary {
            background-color: #b6f5b6;
            color: black;
        }
        button.danger {
            background-color: #dc3545;
            color: white;
        }
        button.secondary {
            background-color: #6c757d;
            color: white;
        }
        .hidden {
            display: none;
        }
        ul {
            text-align: left;
            padding-left: 25px;
            font-size: 20px;
            line-height: 1.6;
        }
        .blink {
            animation: blink 1s infinite;
            font-weight: bold;
            color: red;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
    </style>
</head>
<body>

<div class="container">
    <h2>üö® Sanit√§ter Alarmierung</h2>

    <form id="alarmForm">
        <label for="raum">Raum:</label>
        <input type="text" id="raum" placeholder="z.‚ÄØB. N01" required>

        <label for="aed">Defibrillator (AED) ben√∂tigt?</label>
        <select id="aed">
            <option value="Nein">Nein</option>
            <option value="Ja">Ja</option>
        </select>

        <button type="submit" class="danger">üö® Alarm senden</button>
    </form>

    <div id="postAlarm" class="hidden">
        <p id="response">‚úÖ Sanit√§ter sind alarmiert!</p>
        <button id="startGuide" class="primary">üö® Erste Hilfe Anleitung</button>
    </div>

    <div id="guide" class="hidden">
        <h3 id="stepTitle"></h3>
        <div id="stepContent"></div>
        <div id="stepActions"></div>
        <button id="backBtn" class="secondary hidden">‚¨Ö Zur√ºck</button>
    </div>
</div>

<script>
const guideSteps = [
    { id: "start", title: "Eigenschutz beachten!", options: [{ text: "Weiter", next: "ansprechen" }] },
    {
        id: "ansprechen",
        title: "Ansprechen und Anfassen?",
        options: [
            { text: "Ja, er reagiert", next: "reagiert" },
            { text: "Nein, er reagiert NICHT", next: "atmenPruefen" }
        ]
    },
    {
        id: "reagiert",
        title: "Bleibe ruhig, die Sanit√§ter sind alarmiert.",
        content: `<ul>
            <li>Versorge lebensbedrohliche Verletzungen</li>
            <li>Wird der Rettungsdienst ben√∂tigt? ‚û° Notruf 112</li>
            <li>Betreue den Patienten</li>
            <li>Denke an den W√§rmeerhalt</li>
        </ul>`,
        options: []
    },
    {
        id: "atmenPruefen",
        title: "Pr√ºfe 10 Sekunden, ob der Patient atmet.",
        content: `<ul>
            <li>Patient liegt auf dem R√ºcken</li>
            <li>Oberk√∂rper ist entkleidet</li>
            <li>Kopf ist √ºberstreckt</li>
        </ul>`,
        options: [
            { text: "Ja, der Patient atmet", next: "seitenlage" },
            { text: "Nein, der Patient atmet NICHT", next: "notruf" }
        ]
    },
    {
        id: "seitenlage",
        title: "Lege den Patienten in die stabile Seitenlage.",
        options: [{ text: "Weiter", next: "notruf" }]
    },
    {
        id: "notruf",
        title: "Lasse den Notruf unter 112 absetzen und lasse den Defibrillator (AED) holen.",
        options: [{ text: "Weiter", next: "timer" }]
    },
    {
        id: "timer",
        title: "Atmung in 2 Minuten 30 erneut √ºberpr√ºfen",
        content: `
            <p id="countdown">‚è≥ Atmung erneut √ºberpr√ºfen in: 2:30</p>
            <button class="primary" onclick="showStep('atmenPruefen')">Atmung √ºberpr√ºfen</button>
        `,
        options: []
    },
    {
        id: "atmungCheck",
        title: "<span class='blink'>ATEMUNG √úBERPR√úFEN</span>",
        options: [
            { text: "Atmung √ºberpr√ºfen", next: "atmenPruefen" }
        ]
    },
    {
        id: "druckpunkt",
        title: "Starte Wiederbelebung",
        content: `
            <p><strong>Druckpunkt:</strong> mittig, zwischen den Brustwarzen</p>
            <ul>
                <li><strong>30x</strong> 5‚ÄØcm tief eindr√ºcken + vollst√§ndig entlasten</li>
                <li><strong>2x</strong> f√ºr jeweils 2 Sekunden beatmen</li>
                <li>(Defibrillator einschalten + Anweisungen folgen)</li>
            </ul>
            <button onclick="toggleMetronome(this)" class="primary">‚ñ∂ Metronom starten (100 BPM)</button>
        `,
        options: []
    }
];

let stepHistory = [];
let countdownInterval;
let metronomeInterval = null;
const beep = new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");

function showStep(stepId) {
    clearInterval(countdownInterval);
    const step = guideSteps.find(s => s.id === stepId);
    if (!step) return;

    document.getElementById("stepTitle").innerHTML = step.title;
    document.getElementById("stepContent").innerHTML = step.content || "";
    document.getElementById("stepActions").innerHTML = "";

    step.options.forEach(opt => {
        const btn = document.createElement("button");
        btn.className = "primary";
        btn.innerText = opt.text;
        btn.onclick = () => {
            stepHistory.push(stepId);
            showStep(opt.next);
        };
        document.getElementById("stepActions").appendChild(btn);
    });

    document.getElementById("backBtn").classList.toggle("hidden", stepHistory.length === 0);

    if (stepId === "timer") startCountdown(150); // 2:30 min
}

function startCountdown(seconds) {
    const display = document.getElementById("countdown");
    countdownInterval = setInterval(() => {
        if (seconds <= 0) {
            clearInterval(countdownInterval);
            showStep("atmungCheck");
        } else {
            const min = Math.floor(seconds / 60);
            const sec = seconds % 60;
            display.innerText = `‚è≥ Atmung erneut √ºberpr√ºfen in: ${min}:${sec.toString().padStart(2, '0')}`;
            seconds--;
        }
    }, 1000);
}

function toggleMetronome(button) {
    if (metronomeInterval) {
        clearInterval(metronomeInterval);
        metronomeInterval = null;
        button.innerText = "‚ñ∂ Metronom starten (100 BPM)";
    } else {
        metronomeInterval = setInterval(() => beep.play(), 600); // 100 BPM = 600ms pro Schlag
        button.innerText = "‚èπ Metronom stoppen";
    }
}

document.getElementById("alarmForm").addEventListener("submit", function(e) {
    e.preventDefault();
    document.getElementById("alarmForm").classList.add("hidden");
    document.getElementById("postAlarm").classList.remove("hidden");
});

document.getElementById("startGuide").addEventListener("click", function() {
    document.getElementById("postAlarm").classList.add("hidden");
    document.getElementById("guide").classList.remove("hidden");
    showStep("start");
});

document.getElementById("backBtn").addEventListener("click", function() {
    if (stepHistory.length > 0) {
        const prevStep = stepHistory.pop();
        showStep(prevStep);
    }
});
 
