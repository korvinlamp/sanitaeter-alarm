<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sanit√§ter & Erste Hilfe</title>

  <!-- PWA: Manifest & iOS Support -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#dc3545">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Sanit√§ter App">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
      text-align: center;
      padding: 30px;
      font-size: 20px;
    }
    .hidden { display: none; }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      margin: auto;
      max-width: 500px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      color: #dc3545;
      font-size: 26px;
      margin-bottom: 20px;
    }
    input, button {
      font-size: 20px;
      padding: 14px;
      margin: 12px auto;
      width: 90%;
      max-width: 350px;
    }
    button {
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .btn-red { background-color: #dc3545; color: white; }
    .btn-red:hover { background-color: #c82333; }
    .btn-gray { background-color: #6c757d; color: white; }
    #response { font-size: 24px; font-weight: bold; color: green; margin-top: 25px; }
    #warning { font-size: 18px; color: #6c757d; margin-top: 10px; }
    p { font-size: 20px; line-height: 1.5; }
    .section { margin-top: 25px; }
    .anleitung-box {
      background-color: #fff3cd;
      border: 1px solid #ffeeba;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      text-align: left;
    }
    .step-buttons button { margin-top: 10px; }
    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0; }
      100% { opacity: 1; }
    }
    .blink-red { color: red; font-weight: bold; animation: blink 1s infinite; }
    .firma-hinweis { color: #999; font-size: 16px; margin-top: 10px; }
  </style>
</head>
<body>

<div id="alarm-section" class="container">
  <h2>üö® Sanit√§ter Alarmieren</h2>
  <form id="alarmForm" action="javascript:void(0);">
    <label for="raum">Raum:</label><br>
    <input type="text" id="raum" placeholder="z. B. N01" required><br>
    <button type="submit" class="btn-red">üö® Alarm senden</button>
  </form>
  <p id="response"></p>
  <p id="warning" class="hidden">Dies ersetzt nicht den Notruf 112!</p>
  <div class="section hidden" id="hilfeStartBtn">
    <button class="btn-red" onclick="showAnleitung('eigenschutz')">‚õëÔ∏è Erste Hilfe Anleitung</button>
  </div>
</div>

<div id="anleitung-section" class="container hidden">
  <div id="anleitung-content"></div>
</div>

<script>
  // --- State ---
  let historyStack = [];
  let timerInterval = null;
  let timerRemaining = 0;

  // --- Anleitung Steps ---
  const steps = {
    eigenschutz: {
      title: "‚õëÔ∏è Eigenschutz geht vor!",
      text: ``,
      next: "reaktion"
    },
    reaktion: {
      title: "Reagiert die Person auf Ansprechen oder Anfassen?",
      text: ``,
      nextOptions: [
        { label: "‚úÖ Ja, sie reagiert", next: "ersthilfe" },
        { label: "‚ùå Nein, sie reagiert nicht", next: "atmung-vorbereitung" }
      ]
    },
    ersthilfe: {
      title: "‚úÖ Erste Hilfe nach Notwendigkeit",
      text: `
        <div class="anleitung-box">
          ‚Ä¢ Lebensbedrohliche Verletzungen versorgen<br>
          ‚Ä¢ Notruf 112 n√∂tig?<br>
          ‚Ä¢ Person w√§rmen<br>
          ‚Ä¢ Person betreuen bis Sanit√§ter eintreffen
        </div>
      `,
      next: null
    }
    // ... (die restlichen Schritte aus deinem alten Code hier √ºbernehmen)
  };

  // --- Show Anleitung Section ---
  function showSection() {
    document.getElementById("alarm-section").classList.add("hidden");
    document.getElementById("anleitung-section").classList.remove("hidden");
  }

  // --- Timer-Funktionen ---
  function clearTimer() {
    if(timerInterval) {
      clearInterval(timerInterval);
      timerInterval = null;
    }
  }

  function startCountdown(displayId, durationSeconds) {
    clearTimer();
    timerRemaining = durationSeconds;
    const display = document.getElementById(displayId);
    updateTimerDisplay(display);
    timerInterval = setInterval(() => {
      timerRemaining--;
      if(timerRemaining < 0) {
        clearTimer();
        display.innerHTML = `<span class="blink-red">‚ÄºÔ∏è Atmung jetzt pr√ºfen!</span>`;
        return;
      }
      updateTimerDisplay(display);
    }, 1000);
  }

  function updateTimerDisplay(display) {
    const minutes = Math.floor(timerRemaining / 60);
    const seconds = timerRemaining % 60;
    display.textContent = `‚è≥ ${minutes}:${seconds.toString().padStart(2, '0')}`;
  }

  // --- Anleitung anzeigen ---
  function showAnleitung(stepKey) {
    showSection();
    const step = steps[stepKey];
    if (!step) return;

    if(historyStack[historyStack.length-1] !== stepKey) {
      historyStack.push(stepKey);
    }

    let html = `<h2>${step.title}</h2>${step.text}`;

    if(step.next) {
      html += `<div class="step-buttons"><button class="btn-red" onclick="showAnleitung('${step.next}')">Weiter</button></div>`;
    }
    if(step.nextOptions) {
      step.nextOptions.forEach(opt => {
        html += `<div class="step-buttons"><button class="btn-red" onclick="showAnleitung('${opt.next}')">${opt.label}</button></div>`;
      });
    }

    if(historyStack.length > 1) {
      html += `<br><button class="btn-gray" onclick="goBack()">‚Ü©Ô∏è Zur√ºck</button>`;
    }

    if(step.hinweis){
      html += `<p class="firma-hinweis">${step.hinweis}</p>`;
    }

    document.getElementById("anleitung-content").innerHTML = html;

    if(stepKey === "seitenlage-timer") {
      startCountdown("timerDisplay", 150);
    } else {
      clearTimer();
    }
  }

  function goBack() {
    if(historyStack.length > 1) {
      historyStack.pop();
      const previous = historyStack.pop();
      showAnleitung(previous);
    }
  }

  // --- Alarm-Formular ---
  document.getElementById("alarmForm").addEventListener("submit", function(event){
    event.preventDefault();
    const raum = document.getElementById("raum").value;
    const url = "https://maker.ifttt.com/trigger/sanitaeter-alarm/with/key/cCSCnLcOR4Lqjv_YDsEOYr?value1=" + encodeURIComponent(raum);
    fetch(url).finally(() => {
      document.getElementById("alarmForm").style.display = "none";
      document.getElementById("response").innerText = "‚úÖ Sanit√§ter sind alarmiert!";
      document.getElementById("warning").classList.remove("hidden");
      document.getElementById("hilfeStartBtn").classList.remove("hidden");
    });
  });
</script>
</body>
</html>
